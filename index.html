<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>進化ローグライク</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.js"></script>
</head>
<body>
<script>
class MyGame extends Phaser.Scene {
    constructor() {
        super();
    }

    preload() {}

    create() {
        // プレイヤー
        this.player = this.add.rectangle(400, 300, 30, 30, 0x00ff00);
        this.physics.add.existing(this.player);
        this.player.body.setCollideWorldBounds(true);

        // キーボード入力
        this.cursors = this.input.keyboard.createCursorKeys();
        this.speed = 200;

        // 敵グループ
        this.enemies = this.physics.add.group();

        // DNAポイント
        this.dna = 0;
        this.level = 1;
        this.nextLevelDNA = 5;

        // 定期的に敵をスポーン
        this.time.addEvent({
            delay: 2000,
            callback: () => {
                let x = Phaser.Math.Between(0, 800);
                let y = Phaser.Math.Between(0, 600);
                let enemy = this.add.rectangle(x, y, 20, 20, 0xff0000);
                this.physics.add.existing(enemy);
                this.enemies.add(enemy);
            },
            loop: true
        });

        // 衝突処理（プレイヤーが敵に触れると敵が消えてDNAゲット）
        this.physics.add.overlap(this.player, this.enemies, (player, enemy) => {
            enemy.destroy();
            this.dna++;
            if (this.dna >= this.nextLevelDNA) {
                this.levelUp();
            }
        });
    }

    update() {
        // 移動
        this.player.body.setVelocity(0);
        if (this.cursors.left.isDown) this.player.body.setVelocityX(-this.speed);
        if (this.cursors.right.isDown) this.player.body.setVelocityX(this.speed);
        if (this.cursors.up.isDown) this.player.body.setVelocityY(-this.speed);
        if (this.cursors.down.isDown) this.player.body.setVelocityY(this.speed);
    }

    levelUp() {
        this.level++;
        this.dna = 0;
        this.nextLevelDNA += 5;

        // 進化演出（とりあえずサイズと色を変える）
        this.player.setScale(1 + this.level * 0.2);
        this.player.fillColor = Phaser.Display.Color.RandomRGB().color;

        // 能力強化（例：スピードアップ）
        this.speed += 20;
    }
}

const config = {
    type: Phaser.AUTO,
    width: 800,
    height: 600,
    backgroundColor: "#222",
    physics: { default: "arcade" },
    scene: MyGame
};

new Phaser.Game(config);
</script>
</body>
</html>
